<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>Takeshi Maruyama | Cloud / IT Engineer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="クラウド(AWS)エンジニア / 生成AI・機械学習・データ分析・個人開発に関心があります。" />
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HJD4SS3JXC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HJD4SS3JXC');
</script>


  <style>
    :root {
      --bg: #020617;
      --bg-alt: #020617;
      --card: #020617; 
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border: #1f2937;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      color: var(--text);
      line-height: 1.6;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .page {
      max-width: 1024px;
      margin: 0 auto;
      padding: 0 1.2rem 3rem;
    }

    /* top nav */
    .nav {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.75));
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    .nav-inner {
      max-width: 1024px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 0.4rem;
    }

    .nav-logo {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      gap: 1.1rem;
      font-size: 0.82rem;
    }

    .nav-links a {
      color: var(--text-muted);
    }

    .nav-links a:hover {
      color: var(--accent);
      text-decoration: none;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 1.6rem;
      padding: 2.2rem 0.4rem 2.4rem;
    }

    @media (min-width: 768px) {
      header {
        flex-direction: row;
        align-items: center;
      }
    }

    .avatar {
      width: 96px;
      height: 96px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #38bdf8, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.4rem;
      font-weight: 600;
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 1), 0 0 0 5px rgba(148, 163, 184, 0.3);
      flex-shrink: 0;
    }

    .hero-main {
      flex: 1;
    }

    .hero-role {
      font-size: 0.92rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 0.5rem;
    }

    .hero-name {
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      margin-bottom: 0.6rem;
    }

    .hero-summary {
      font-size: 0.96rem;
      color: var(--text-muted);
      max-width: 34rem;
      word-break: break-word;
      hyphens: auto;
    }

    .chips {
      display: flex;
      flex-wrap: nowrap;
      gap: 0.5rem;
      margin-top: 1rem;
      overflow-x: auto;
      padding-bottom: 0.3rem;
      -webkit-overflow-scrolling: touch;
    }

    .chip {
      font-size: 0.75rem;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .chip-primary {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .hero-side {
      min-width: 220px;
      padding: 1.2rem 1.4rem;
      border-radius: 0.9rem;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(30, 64, 175, 0.6);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    .hero-side h2 {
      margin: 0 0 0.7rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .hero-links {
      font-size: 0.85rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    main {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    section {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 1rem;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 1.5rem 1.6rem;
    }

    section.highlight {
      border-color: rgba(30, 64, 175, 0.8);
    }

    section h2 {
      font-size: 0.95rem;
      margin: 0 0 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .section-body {
      font-size: 0.93rem;
      color: var(--text-muted);
    }

    .list {
      list-style: none;
      padding: 0;
      margin: 0.4rem 0 0;
      font-size: 0.93rem;
    }

    .list li {
      margin-bottom: 0.45rem;
    }

    .list strong {
      color: var(--text);
    }

    /* project cards */
    .projects {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.9rem;
      margin-top: 0.4rem;
    }

    @media (min-width: 720px) {
      .projects {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .project-card {
      padding: 0.9rem 1rem;
      border-radius: 0.8rem;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .project-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.1rem;
    }

    .project-meta {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
    }

    .project-desc {
      font-size: 0.86rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .project-links a {
      font-size: 0.8rem;
      margin-right: 0.6rem;
    }

    .feed-grid {
      display: grid;
      gap: 0.8rem;
      margin-top: 0.6rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .feed-tabs,
    .feed-source-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 0.4rem 0 0.2rem;
    }

    .feed-tab {
      font-size: 0.75rem;
      padding: 0.28rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      cursor: pointer;
    }

    .feed-tab.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .feed-card {
      padding: 0.85rem 0.95rem;
      border-radius: 0.8rem;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.9);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      min-height: 108px;
    }

    .feed-source {
      font-size: 0.72rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .feed-title {
      font-size: 0.92rem;
      color: var(--text);
    }

    .feed-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .feed-empty {
      font-size: 0.9rem;
      color: var(--text-muted);
      padding: 0.4rem 0;
    }

    .feed-more {
      margin-top: 0.6rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      font-size: 0.8rem;
      cursor: pointer;
    }

    .feed-more:hover {
      color: var(--accent);
      border-color: var(--accent);
    }

    .contrib-wrap {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .contrib-scroll {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      overflow-x: auto;
      padding-bottom: 0.2rem;
      overscroll-behavior: contain;
    }

    .contrib-body {
      display: flex;
      gap: 0.6rem;
      align-items: flex-start;
    }

    .contrib-weekdays {
      display: grid;
      grid-template-rows: repeat(7, 12px);
      gap: 3px;
      font-size: 0.75rem;
      color: var(--text-muted);
      padding-top: 0.4rem;
      width: 32px;
    }

    .contrib-weekdays span {
      line-height: 12px;
    }

    .contrib-months {
      position: relative;
      height: 18px;
      font-size: 0.73rem;
      color: var(--text-muted);
      width: fit-content;
      max-width: 100%;
    }

    .contrib-months span {
      position: absolute;
      white-space: nowrap;
      transform: translateX(-50%);
      padding: 0 2px;
      background: rgba(2, 6, 23, 0.7);
      border-radius: 4px;
    }

    .contrib-grid {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 12px;
      grid-template-rows: repeat(7, 12px);
      gap: 3px;
      padding: 0.4rem 0 0.2rem;
      width: fit-content;
      max-width: 100%;
    }

    .contrib-cell {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      background: #1f2937;
    }

    .contrib-legend {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
      flex-wrap: wrap;
    }

    .legend-swatch {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      display: inline-block;
    }

    .stat-line {
      display: flex;
      gap: 0.6rem;
      align-items: baseline;
      margin: 0 0 0.4rem;
      font-size: 0.93rem;
      color: var(--text-muted);
      flex-wrap: wrap;
    }

    .stat-line strong {
      color: var(--text);
      font-size: 1.02rem;
    }

    .stat-sub {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    footer {
      margin-top: 2.4rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      padding-bottom: 1rem;
    }

    html {
      scroll-behavior: smooth;
    }

    @media (max-width: 640px) {
      .page {
        padding: 0 1rem 2.5rem;
      }

      .nav-inner {
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: flex-start;
        font-size: 0.78rem;
        gap: 0.8rem;
      }

      header {
        padding: 1.4rem 0.4rem 1.6rem;
        gap: 1.2rem;
      }

      .hero-summary {
        max-width: none;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .hero-side {
        width: 100%;
        margin-top: 0.4rem;
      }

      .chips {
        flex-wrap: wrap;
        overflow-x: visible;
      }

      .projects {
        grid-template-columns: 1fr;
      }

      .contrib-months {
        font-size: 0.7rem;
      }
    }
  </style>
</head>

<body>
  <nav class="nav">
    <div class="nav-inner">
      <div class="nav-logo">PORTFOLIO</div>
      <div class="nav-links">
        <a href="#about">About</a>
        <a href="#skills">Skills</a>
        <a href="#experience">Experience</a>
        <a href="#works">Works</a>
        <a href="#updates">Updates</a>
        <a href="/blog/">Blog</a>
        <a href="#contact">Contact</a>
      </div>
    </div>
  </nav>

  <div class="page">
    <header>
      <div class="avatar">TM</div>
      <div class="hero-main">
        <div class="hero-role">Cloud / IT Engineer</div>
        <div class="hero-name">Takeshi Maruyama</div>
        <p class="hero-summary">
          本業で AWS を中心としたインフラ／サーバーサイドを担当しています。要件定義・設計・構築・実装・テストが主領域で、フロントエンドは必要最低限に触れる程度です。
          個人では生成 AI や Python の機械学習を使った Web / モバイルアプリを多数試行しています。
        </p>
        <div class="chips">
          <span class="chip chip-primary">AWS / Cloud</span>
          <span class="chip">Generative AI / RAG</span>
          <span class="chip">Machine Learning</span>
          <span class="chip">Data Analytics</span>
          <span class="chip">Personal Projects</span>
        </div>
      </div>
      <aside class="hero-side">
        <h2>Links</h2>
        <div class="hero-links">
          <div><strong>GitHub</strong>：<a href="https://github.com/tmaru-eng" target="_blank"
              rel="noopener noreferrer">tmaru-eng</a></div>
          <div><strong>Qiita</strong>：<a href="https://qiita.com/tmaru-eng" target="_blank"
              rel="noopener noreferrer">@tmaru-eng</a></div>
          <div><strong>X</strong>：<a href="https://x.com/tmaru_eng" target="_blank"
              rel="noopener noreferrer">@tmaru_eng</a></div>
          <div><strong>Credly</strong>：<a href="https://www.credly.com/users/tmaru-eng/badges#credly" target="_blank"
              rel="noopener noreferrer">Badges</a></div>
        </div>
      </aside>
    </header>

    <main>
      <section id="about" class="highlight">
        <h2>About</h2>
        <div class="section-body">
          <p>
            AWS を軸にしたインフラ／サーバーサイドを担当し、要件定義・設計・構築・実装・テストが主領域です。
            Databricks でのデータ分析基盤構築や、Python での機械学習・生成 AI 検証にも取り組んでいます。
          </p>
          <p>
            個人開発では生成 AI / RAG を活用した Web / モバイルアプリを多数試行しています。ここでは活動のスナップショットやリンクをまとめています。
          </p>
        </div>
      </section>

      <section id="skills">
        <h2>Skills &amp; Interests</h2>
        <div class="section-body">
          <ul class="list">
            <li><strong>Cloud</strong>：AWS（要件定義・設計・構築／Control Tower ベースのガバナンス設計を含む）／ 一部 Azure・OCI</li>
            <li><strong>Infrastructure &amp; Ops</strong>：VPC / EC2 / ECS / Lambda / RDS / S3 / IAM / CloudWatch などの設計・構築（要件定義〜実装・テストが中心）</li>
            <li><strong>OS / On-Prem</strong>：Windows / Linux / VMware 環境の設計・運用経験</li>
            <li><strong>CI/CD</strong>：GitHub Actions や AWS CodePipeline / CodeCatalyst でのパイプライン構築（インフラ／アプリの自動化）</li>
            <li><strong>Monitoring</strong>：Datadog 資格レベルの知識（実務はこれから拡充）</li>
            <li><strong>Data &amp; ML</strong>：Databricks でのデータ分析基盤構築経験、Python での機械学習検証</li>
            <li><strong>AI / Generative AI</strong>：生成 AI 活用、RAG 構築・検証、プロンプト設計、LLM API 利用</li>
            <li><strong>Front-end</strong>：必要最低限の実装対応（主領域はインフラ／サーバー）</li>
            <li><strong>Interests</strong>：クラウド設計、SaaS 連携、MLOps、個人開発プロダクトづくり</li>
          </ul>
        </div>
      </section>

      <section id="experience">
        <h2>Experience &amp; Certifications</h2>
        <div class="section-body">
          <ul class="list">
            <li>
              <strong>Cloud / IT Engineer</strong><br />
              AWS を中心としたクラウドインフラ・基盤の設計・構築・運用を担当。要件整理から運用設計まで一通りを経験。
            </li>
            <li>
              <strong>Certifications</strong><br />
              IPA / AWS / Azure / OCI / Datadog などの資格を保有。クラウド全般と監視・運用領域の知識を継続的にアップデートしています。
            </li>
            <li>
              <strong>Learning / Community</strong><br />
              個人開発、Qiita での技術メモ、X での学習ログポストなどを通じて、クラウドと生成 AI 周辺のキャッチアップを継続中です。
            </li>
          </ul>
        </div>
      </section>

      <section id="works">
        <h2>Works / Projects</h2>
        <div class="section-body">
          <p>
            個人開発や検証用のリポジトリは GitHub にまとまっています。Webアプリやスマホアプリなど複数のプロダクトを並行で開発中で、ここでは代表的なものをピックアップしています（随時追加予定）。
          </p>
          <div class="projects">
            <div class="project-card">
              <div class="project-title">Life Design App</div>
              <div class="project-meta">Web App / Personal Development</div>
              <div class="project-desc">
                日々の目標やタスクを可視化し、習慣化をサポートするライフデザイン用 Web アプリ。レスポンシブ対応でスマートフォンからも利用可能。
              </div>
              <div class="project-links">
                <a href="https://life-design-app.com/" target="_blank" rel="noopener noreferrer">Live</a>
              </div>
            </div>

            <div class="project-card">
              <div class="project-title">notehub-gas</div>
              <div class="project-meta">OSS / Google Apps Script</div>
              <div class="project-desc">
                note からの記事取得・投稿を自動化し、Google スプレッドシートと連携する OSS。Apps Script ベースで小規模チームでも使いやすい構成。
              </div>
              <div class="project-links">
                <a href="https://github.com/tmaru-eng/notehub-gas" target="_blank" rel="noopener noreferrer">GitHub</a>
              </div>
            </div>

            <!-- <div class="project-card">
              <div class="project-title">React 学習用ジョークサイト</div>
              <div class="project-meta">Web App / React</div>
              <div class="project-desc">
                React の学習用途で作成したジョーク集サイト。軽量なコンポーネント構成で Hooks を試しつつ、デプロイは Cloudflare Pages で行い手軽に公開。
              </div>
              <div class="project-links">
                <a href="https://legacy-homepage-react.pages.dev/" target="_blank" rel="noopener noreferrer">Live</a>
              </div>
            </div> -->
            <div class="project-card">
              <div class="project-title">その他（個人開発）</div>
              <div class="project-meta">Mobile App / Personal Project</div>
              <div class="project-desc">
                スマホアプリやユーティリティ系の小さなツールを複数開発中。実プロダクトのリポジトリはプライベート（公開不可）のため、進捗や活動の雰囲気は GitHub Activity を参考にしてください。
              </div>
              <div class="project-links">
                <a href="#activity">GitHub Activity</a>
              </div>
            </div>
          </div>
          <p style="margin-top:0.8rem;">
            公開リポジトリは <a href="https://github.com/tmaru-eng?tab=repositories" target="_blank"
              rel="noopener noreferrer">GitHub Repositories</a> から確認できます（private は非公開）。
          </p>
        </div>
      </section>

      <section id="updates">
        <h2>Latest Updates</h2>
        <div class="section-body">
          <p class="stat-line" style="margin-top:0.2rem;">
            記事フィード集約:
            <span class="stat-sub" id="feed-updated">未取得</span>
          </p>
          <div id="feed-tabs" class="feed-tabs" aria-label="Year tabs"></div>
          <div id="feed-source-tabs" class="feed-source-tabs" aria-label="Source tabs"></div>
          <div id="feed-list" class="feed-grid" aria-live="polite"></div>
          <button id="feed-more" class="feed-more" type="button" hidden>もっと見る</button>
          <p style="margin:0.2rem 0 0;font-size:0.86rem;color:var(--text-muted);">
            Qiita / Zenn / はてなブログの最新記事を週次で集約しています。
          </p>
        </div>
      </section>

      <section id="activity">
        <h2>GitHub Activity</h2>
        <div class="section-body">
          <p class="stat-line" style="margin-top:0.2rem;">
            リポジトリ数: <strong id="repo-total">-</strong>
            <span class="stat-sub" id="repo-breakdown"></span>
          </p>
          <p class="stat-line">
            直近1年のContribution（Public + Private）:
            <strong id="contrib-total">未取得</strong>
            <span class="stat-sub" id="contrib-updated"></span>
          </p>
          <div class="contrib-wrap">
            <div class="contrib-scroll">
              <div class="contrib-months" id="contrib-months"></div>
              <div class="contrib-body">
                <div class="contrib-weekdays" aria-hidden="true">
                  <span>月</span>
                  <span></span>
                  <span>水</span>
                  <span></span>
                  <span>金</span>
                  <span></span>
                  <span>日</span>
                </div>
                <div id="contrib-grid" class="contrib-grid" aria-label="Contribution heatmap"></div>
              </div>
            </div>
            <div class="contrib-legend">
              <span>少</span>
              <span class="legend-swatch" style="background:#1f2937"></span>
              <span class="legend-swatch" style="background:#234361"></span>
              <span class="legend-swatch" style="background:#2f5c85"></span>
              <span class="legend-swatch" style="background:#3b76aa"></span>
              <span class="legend-swatch" style="background:#4996cf"></span>
              <span>多</span>
            </div>
          </div>
          <p style="margin:0;font-size:0.86rem;color:var(--text-muted);">
            プライベート分はリアルタイム取得できないため、本ページの Activity 情報は push 時に更新したスナップショットです。
          </p>
        </div>
      </section>

      <section id="contact">
        <h2>Contact</h2>
        <div class="section-body">
          <p>
            業務外でのクラウド / 生成 AI / 個人開発まわりの情報交換や、ゆるいご相談などは X からご連絡ください。
          </p>
          <ul class="list">
            <li><strong>X</strong>：<a href="https://x.com/tmaru_eng" target="_blank"
                rel="noopener noreferrer">@tmaru_eng</a></li>
          </ul>
          <p style="margin-top:0.6rem;font-size:0.84rem;color:var(--text-muted);">
            ※本サイトおよびリンク先アカウントでの内容は、所属組織とは関係のない個人の見解です。
          </p>
        </div>
      </section>
    </main>

    <footer>
      &copy; <span id="year"></span> tmaru-eng
    </footer>
  </div>

  <script src="data/feeds.js"></script>
  <script src="data/contributions.js"></script>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    function loadFeeds() {
      const listEl = document.getElementById("feed-list");
      const updatedEl = document.getElementById("feed-updated");
      const tabsEl = document.getElementById("feed-tabs");
      const sourceTabsEl = document.getElementById("feed-source-tabs");
      const moreEl = document.getElementById("feed-more");
      if (!listEl) return;

      const jpTime = { timeZone: "Asia/Tokyo" };
      const state = {
        items: [],
        filteredItems: [],
        grouped: {},
        years: [],
        activeYear: null,
        sources: [],
        activeSource: "all",
        visibleCount: 9,
        step: 9,
      };

      const rebuildGroups = () => {
        const items = state.activeSource === "all"
          ? state.items
          : state.items.filter((item) => item.sourceId === state.activeSource);
        state.filteredItems = items;
        const grouped = new Map();
        items.forEach((item) => {
          const year = item.publishedAt
            ? String(new Date(item.publishedAt).getFullYear())
            : "Unknown";
          if (!grouped.has(year)) grouped.set(year, []);
          grouped.get(year).push(item);
        });
        const years = Array.from(grouped.keys()).sort((a, b) => {
          if (a === "Unknown") return 1;
          if (b === "Unknown") return -1;
          return Number(b) - Number(a);
        });
        state.grouped = Object.fromEntries(grouped);
        state.years = years;
        if (!state.activeYear || (state.activeYear !== "all" && !state.grouped[state.activeYear])) {
          state.activeYear = "all";
        }
      };

      const render = (data) => {
        if (!data || !Array.isArray(data.items) || data.items.length === 0) {
          listEl.innerHTML = '<div class="feed-empty">フィードは準備中です。</div>';
          if (tabsEl) tabsEl.innerHTML = "";
          if (sourceTabsEl) sourceTabsEl.innerHTML = "";
          if (moreEl) moreEl.hidden = true;
          return false;
        }
        state.items = data.items.slice();
        const sources = Array.isArray(data.sources)
          ? data.sources.map((source) => ({ id: source.id, name: source.name }))
          : [];
        const fallbackSources = Array.from(
          new Set(state.items.map((item) => item.sourceId).filter(Boolean))
        ).map((id) => ({ id, name: id }));
        state.sources = sources.length ? sources : fallbackSources;
        if (!state.activeSource) state.activeSource = "all";
        rebuildGroups();

        const renderTabs = () => {
          if (!tabsEl) return;
          tabsEl.innerHTML = "";
          const allBtn = document.createElement("button");
          allBtn.type = "button";
          allBtn.className = `feed-tab${state.activeYear === "all" ? " active" : ""}`;
          allBtn.textContent = "All";
          allBtn.addEventListener("click", () => {
            state.activeYear = "all";
            state.visibleCount = state.step;
            renderList();
            renderTabs();
          });
          tabsEl.appendChild(allBtn);
          state.years.forEach((year) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = `feed-tab${year === state.activeYear ? " active" : ""}`;
            btn.textContent = year === "Unknown" ? "Unknown" : `${year}`;
            btn.addEventListener("click", () => {
              state.activeYear = year;
              state.visibleCount = state.step;
              renderList();
              renderTabs();
            });
            tabsEl.appendChild(btn);
          });
        };

        const renderSourceTabs = () => {
          if (!sourceTabsEl) return;
          sourceTabsEl.innerHTML = "";
          const allBtn = document.createElement("button");
          allBtn.type = "button";
          allBtn.className = `feed-tab${state.activeSource === "all" ? " active" : ""}`;
          allBtn.textContent = "All";
          allBtn.addEventListener("click", () => {
            state.activeSource = "all";
            state.visibleCount = state.step;
            state.activeYear = "all";
            rebuildGroups();
            renderTabs();
            renderList();
            renderSourceTabs();
          });
          sourceTabsEl.appendChild(allBtn);
          state.sources.forEach((source) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = `feed-tab${source.id === state.activeSource ? " active" : ""}`;
            btn.textContent = source.name;
            btn.addEventListener("click", () => {
              state.activeSource = source.id;
              state.visibleCount = state.step;
              state.activeYear = "all";
              rebuildGroups();
              renderTabs();
              renderList();
              renderSourceTabs();
            });
            sourceTabsEl.appendChild(btn);
          });
        };

        const renderList = () => {
          listEl.innerHTML = "";
          const yearItems = state.activeYear === "all"
            ? state.filteredItems
            : (state.grouped[state.activeYear] || []);
          const slice = yearItems.slice(0, state.visibleCount);
          slice.forEach((item) => {
            const card = document.createElement("div");
            card.className = "feed-card";
            const title = document.createElement("a");
            title.className = "feed-title";
            title.href = item.url;
            title.target = "_blank";
            title.rel = "noopener noreferrer";
            title.textContent = item.title || "Untitled";

            const source = document.createElement("div");
            source.className = "feed-source";
            source.textContent = item.sourceLabel || item.sourceId || "Feed";

            const meta = document.createElement("div");
            meta.className = "feed-meta";
            const dateText = item.publishedAt
              ? new Date(item.publishedAt).toLocaleDateString("ja-JP", jpTime)
              : "Date N/A";
            meta.textContent = dateText;
            if (item.sourceUrl) {
              const sourceLink = document.createElement("a");
              sourceLink.href = item.sourceUrl;
              sourceLink.target = "_blank";
              sourceLink.rel = "noopener noreferrer";
              sourceLink.textContent = "Source";
              sourceLink.style.fontSize = "0.78rem";
              sourceLink.style.color = "var(--text-muted)";
              meta.appendChild(document.createTextNode(" / "));
              meta.appendChild(sourceLink);
            }

            card.appendChild(source);
            card.appendChild(title);
            card.appendChild(meta);
            listEl.appendChild(card);
          });

          if (moreEl) {
            const remaining = yearItems.length - slice.length;
            moreEl.hidden = remaining <= 0;
            moreEl.textContent = remaining > 0 ? `もっと見る（残り ${remaining} 件）` : "もっと見る";
          }
        };

        if (moreEl) {
          moreEl.addEventListener("click", () => {
            const yearItems = state.activeYear === "all"
              ? state.filteredItems
              : (state.grouped[state.activeYear] || []);
            state.visibleCount = yearItems.length;
            renderList();
          });
        }

        renderTabs();
        renderSourceTabs();
        renderList();

        if (data.fetchedAt && updatedEl) {
          const d = new Date(data.fetchedAt);
          if (!isNaN(d)) {
            updatedEl.textContent = `（更新: ${d.toLocaleString("ja-JP", jpTime)}）`;
          }
        }
        return true;
      };

      if (render(window.FEED_DATA)) return;

      fetch("data/feeds.json", { cache: "no-store" })
        .then((res) => (res.ok ? res.json() : null))
        .then((data) => render(data))
        .catch(() => {
          listEl.innerHTML = '<div class="feed-empty">フィード取得に失敗しました。</div>';
        });
    }

    function loadContributions() {
      const totalEl = document.getElementById("contrib-total");
      const updatedEl = document.getElementById("contrib-updated");
      const gridEl = document.getElementById("contrib-grid");
      const monthsEl = document.getElementById("contrib-months");
      const repoTotalEl = document.getElementById("repo-total");
      const repoBreakdownEl = document.getElementById("repo-breakdown");
      if (!totalEl) return;

      // 落ち着いたがコントラストのあるブルー系パレット
      const palette = ["#1f2937", "#234361", "#2f5c85", "#3b76aa", "#4996cf"];
      const colorForCount = (count, max) => {
        if (!count) return palette[0];
        const t1 = Math.max(1, Math.ceil(max * 0.15));
        const t2 = Math.max(t1 + 1, Math.ceil(max * 0.35));
        const t3 = Math.max(t2 + 1, Math.ceil(max * 0.55));
        const t4 = Math.max(t3 + 1, Math.ceil(max * 0.8));
        if (count <= t1) return palette[1];
        if (count <= t2) return palette[2];
        if (count <= t3) return palette[3];
        if (count <= t4) return palette[4];
        return palette[4];
      };

      const renderGrid = (calendar) => {
        if (!gridEl || !calendar?.weeks) return;
        gridEl.innerHTML = "";
        const fallback = "#1f2937";

        // 求めておく最大値（色スケール用）
        const allCounts = calendar.weeks.flatMap((w) =>
          (w.contributionDays || []).map((d) => d.contributionCount || 0)
        );
        const maxCount = Math.max(0, ...allCounts);
        const columnWidth = 12 + 3;
        const totalWidth = calendar.weeks.length * columnWidth;
        gridEl.style.width = `${totalWidth}px`;
        gridEl.style.minWidth = `${totalWidth}px`;

        calendar.weeks.forEach((week) => {
          (week.contributionDays || []).forEach((day) => {
            const cell = document.createElement("div");
            cell.className = "contrib-cell";
            const color = colorForCount(day.contributionCount || 0, maxCount) || day.color || fallback;
            cell.style.backgroundColor = color;
            cell.title = `${day.date}: ${day.contributionCount} contributions`;
            gridEl.appendChild(cell);
          });
        });
      };

      const renderMonths = (calendar) => {
        if (!monthsEl || !calendar?.weeks) return;
        monthsEl.innerHTML = "";
        const columnWidth = 12 + 3; // cell + gap
        let prevMonth = null;
        let lastPlaced = -999;
        const monthOffset = 32 + 10; // weekday labels (32px) + gap (~10px)
        calendar.weeks.forEach((week, idx) => {
          const firstDay = week.contributionDays?.[0]?.date;
          if (!firstDay) return;
          const d = new Date(firstDay);
          if (isNaN(d)) return;
          const month = d.getMonth(); // 0-based
          const left = idx * columnWidth;
          // 月が変わった時だけラベルを置く。密集を避けるため配置間隔を確保。
          if (month === prevMonth || left - lastPlaced < 38) return;
          prevMonth = month;
          const span = document.createElement("span");
          span.textContent = `${month + 1}月`;
          span.style.left = `${left + monthOffset}px`;
          monthsEl.appendChild(span);
          lastPlaced = left;
        });
        // グリッド幅に合わせる
        const totalWidth = calendar.weeks.length * columnWidth + monthOffset;
        monthsEl.style.width = `${totalWidth}px`;
        monthsEl.style.minWidth = `${totalWidth}px`;
        monthsEl.style.paddingLeft = `${monthOffset}px`;
      };

      const applyData = (data) => {
        if (!data || !data.totalContributions) return false;
        totalEl.textContent = Number(data.totalContributions).toLocaleString("ja-JP");
        if (data.fetchedAt && updatedEl) {
          const d = new Date(data.fetchedAt);
          if (!isNaN(d)) {
            updatedEl.textContent = `（更新: ${d.toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" })}）`;
          }
        }
        renderGrid(data.calendar || data.contributionCalendar);
        renderMonths(data.calendar || data.contributionCalendar);

        // repo counts
        if (repoTotalEl && repoBreakdownEl && data.repositories) {
          const pub = data.repositories.public;
          const pri = data.repositories.private;
          const total =
            typeof pub === "number" && typeof pri === "number"
              ? pub + pri
              : data.repositories.total ?? pub ?? pri ?? null;
          if (typeof total === "number") {
            repoTotalEl.textContent = total.toLocaleString("ja-JP");
          }
          const parts = [];
          if (typeof pub === "number") parts.push(`Public ${pub}`);
          if (typeof pri === "number") parts.push(`Private ${pri}`);
          repoBreakdownEl.textContent = parts.join(" / ");
        }
        return true;
      };

      // 1) 事前に埋め込まれた window.CONTRIB_DATA を優先（file:// でも動く）
      if (applyData(window.CONTRIB_DATA)) return;

      // 2) サーバー配信時はこちらで最新を取得
      fetch("data/contributions.json", { cache: "no-store" })
        .then((res) => (res.ok ? res.json() : null))
        .then((data) => applyData(data))
        .catch(() => { });
    }

    if (document.readyState === "loading") {
      document.addEventListener(
        "DOMContentLoaded",
        () => {
          loadFeeds();
          loadContributions();
        },
        { once: true }
      );
    } else {
      loadFeeds();
      loadContributions();
    }
  </script>
</body>

</html>
